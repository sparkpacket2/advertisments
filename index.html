<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{[| sparkpacket | advertisements |]}</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    /* Retro terminal theme */
    :root{
      --bg:#030303;
      --panel:#07100a;
      --glow: rgba(0,255,120,0.08);
      --accent: #39ff14;
      --muted: #8fbf8f;
      --mono: "Courier New", Courier, monospace;
      --max-width: 980px;
    }
    html,body{height:100%;}
    body{
      margin:0;
      font-family:var(--mono);
      background:linear-gradient(180deg,var(--bg),#000 60%);
      color:var(--accent);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:30px;display:flex;align-items:start;justify-content:center;

      /* background image support */
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
    }
    .shell{width:100%;max-width:var(--max-width);box-shadow:0 8px 40px rgba(0,0,0,0.7);border-radius:8px;overflow:hidden;background:rgba(0,0,0,0.6)}
    .header{background:#050505;padding:18px 20px;display:flex;align-items:center;gap:12px}
    .dots{display:inline-flex;gap:8px}
    .dot{width:12px;height:12px;border-radius:999px;background:#2b2b2b;box-shadow:0 0 8px var(--glow) inset}
    .title{flex:1;color:var(--muted);font-size:14px}
    .content{display:flex;gap:20px;padding:22px;background:linear-gradient(180deg,#0000, rgba(0,0,0,0.05));}
    .left{flex:1;min-width:320px}
    .right{width:360px;max-width:40%;min-width:260px;background:rgba(0,0,0,0.12);padding:12px;border-radius:6px}
    h1{margin:0;font-size:20px;color:var(--accent)}
    h2{margin:0;font-size:14px;color:var(--muted)}
    p{line-height:1.45;color:var(--accent);margin-top:12px;white-space:pre-wrap}
    .section{margin-top:18px;padding-top:12px;border-top:1px dashed rgba(57,255,20,0.06)}
    .images{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .images img{max-width:100%;width:120px;height:120px;object-fit:cover;border-radius:4px;border:1px solid rgba(57,255,20,0.05);background:#021}
    .nav{display:flex;gap:8px;flex-wrap:wrap}
    .nav a{color:var(--muted);text-decoration:none;padding:6px 8px;border-radius:4px;font-size:13px;background:rgba(57,255,20,0.02)}
    .prompt{display:flex;gap:8px;align-items:center;margin-top:14px}
    .prompt .cursor{display:inline-block;width:10px;height:18px;background:var(--accent);opacity:0.9;animation:blink 1s steps(2) infinite}
    @keyframes blink{50%{opacity:0}}    
    .footer{padding:12px 20px;background:#050505;color:var(--muted);font-size:12px}
    pre.small{font-size:12px;color:var(--muted);margin:0}

    /* responsive */
    @media (max-width:820px){
      .content{flex-direction:column}
      .right{width:100%;max-width:none}
    }
  </style>
</head>
<body>
  <div class="shell" role="main">
    <div class="header">
      <div class="dots" aria-hidden>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div class="title" id="site-title">Loading...</div>
      <div style="font-size:12px;color:var(--muted)">advertisements</div>
    </div>

    <div class="content">
      <main class="left" id="main">
        <h1 id="headline">—</h1>
        <h2 id="subhead">—</h2>
        <p id="intro">—</p>

        <div id="sections"></div>

        <div class="prompt" aria-hidden>
          <span class="small" style="color:var(--muted)">sparkpackettech@terminal:~$</span>
          <div class="cursor" aria-hidden></div>
        </div>
      </main>

      <aside class="right">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-size:13px;color:var(--muted)">Quick links</div>
        </div>
        <div class="nav" id="nav"></div>
        <hr style="opacity:.06;margin:12px 0">
        <div style="font-size:13px;color:var(--muted)">Raw content.json</div>
        <pre class="small" id="raw" style="max-height:220px;overflow:auto;background:#000;padding:8px;border-radius:6px;margin-top:8px">{ }</pre>
      </aside>
    </div>

    <div class="footer">This page loads <code>./content.json</code> and images from <code>./image/&lt;filename&gt;</code>. To update: edit content.json and push images into the image/ folder.</div>
  </div>

  <script>
    // Load content.json from the current folder.
    async function load() {
      const rawEl = document.getElementById('raw');
      const titleEl = document.getElementById('site-title');
      const headline = document.getElementById('headline');
      const subhead = document.getElementById('subhead');
      const intro = document.getElementById('intro');
      const sections = document.getElementById('sections');
      const nav = document.getElementById('nav');

      try {
        const resp = await fetch('./content.json', {cache: 'no-store'});
        if (!resp.ok) throw new Error('missing content.json');
        const json = await resp.json();
        rawEl.textContent = JSON.stringify(json, null, 2);

        titleEl.textContent = json.title || document.title;
        headline.textContent = json.title || '—';
        subhead.textContent = json.subtitle || '';
        intro.textContent = json.intro || '';

        // apply background if present
        if (json.background) {
          document.body.style.backgroundImage = `url('./image/${json.background}')`;
        }

        // render sections
        sections.innerHTML = '';
        (json.sections || []).forEach(s => {
          const sec = document.createElement('section');
          sec.className = 'section';
          const h = document.createElement('h3'); h.textContent = s.heading || '';
          const p = document.createElement('p'); p.textContent = s.text || '';
          sec.appendChild(h);
          sec.appendChild(p);
          if (s.images && s.images.length) {
            const wrap = document.createElement('div'); wrap.className = 'images';
            s.images.forEach(fn => {
              const img = document.createElement('img');
              img.src = './image/' + fn;
              img.alt = fn;
              img.loading = 'lazy';
              wrap.appendChild(img);
            });
            sec.appendChild(wrap);
          }
          sections.appendChild(sec);
        });

        // nav
        nav.innerHTML = '';
        (json.links || []).forEach(l => {
          const a = document.createElement('a'); a.href = l.href; a.textContent = l.label; a.rel='noopener';
          nav.appendChild(a);
        });

      } catch (err) {
        rawEl.textContent = 'Error loading ./content.json — create one next to index.html.\n' + err;
        titleEl.textContent = 'No content.json found';
        headline.textContent = 'Create content.json';
        subhead.textContent = '';
        intro.textContent = 'Put a file named content.json next to this index.html. See the commented example at the top of the file.';
      }
    }

    load();
  </script>
</body>
</html>
